<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <title>Literary Bookshelf 2025</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: transparent; min-height: 100vh; color: #1d1d1f; margin: 0; padding: 0; }
        .container { max-width: 1400px; margin: 0 auto; padding: 40px 20px; }
        .stats-banner { text-align: center; margin-bottom: 40px; padding: 30px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.08), rgba(240, 147, 251, 0.08)); border-radius: 20px; }
        .stats-banner h2 { font-size: 2rem; font-weight: 600; margin-bottom: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .stats-banner p { font-size: 1.1rem; opacity: 0.7; }
        header { text-align: center; margin-bottom: 60px; }
        h1 { font-size: 3.5rem; font-weight: 300; letter-spacing: 2px; margin-bottom: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .subtitle { font-size: 1.2rem; opacity: 0.6; }
        .controls { display: flex; justify-content: center; gap: 20px; margin-bottom: 40px; flex-wrap: wrap; }
        .view-toggle { display: flex; gap: 10px; background: #fff; padding: 8px; border-radius: 50px; border: 1px solid #e5e5e7; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .view-btn { padding: 12px 24px; border: none; background: transparent; color: #1d1d1f; cursor: pointer; border-radius: 50px; font-size: 0.95rem; transition: all 0.3s ease; font-weight: 500; }
        .view-btn:hover { background: #f5f5f7; }
        .view-btn.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); color: #fff; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); }
        .filter-toggle { padding: 12px 28px; border: 1px solid #e5e5e7; background: #fff; color: #1d1d1f; cursor: pointer; border-radius: 50px; font-size: 0.95rem; transition: all 0.3s ease; font-weight: 500; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .filter-toggle:hover { background: #f5f5f7; }
        .filter-toggle.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); color: #fff; border-color: transparent; }
        .books-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; }
        .book-card { background: #fff; border-radius: 20px; border: 1px solid #e5e5e7; transition: all 0.4s ease; cursor: pointer; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        .book-card:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); border-color: rgba(102, 126, 234, 0.3); }
        .book-card-content { padding: 25px; position: relative; }
        .book-edit-btn { position: absolute; top: 15px; right: 15px; width: 32px; height: 32px; border-radius: 50%; background: rgba(102, 126, 234, 0.1); border: 1px solid rgba(102, 126, 234, 0.3); color: #667eea; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; transition: all 0.3s ease; opacity: 0; }
        .book-card:hover .book-edit-btn { opacity: 1; }
        .book-edit-btn:hover { background: linear-gradient(135deg, #667eea, #764ba2); color: #fff; transform: scale(1.1); }
        .book-title { font-size: 1.3rem; font-weight: 600; margin-bottom: 8px; line-height: 1.3; }
        .book-author { font-size: 0.95rem; opacity: 0.6; margin-bottom: 12px; }
        .book-rating { font-size: 1rem; margin-bottom: 10px; }
        .book-genre { font-size: 0.8rem; opacity: 0.5; margin-bottom: 8px; }
        .book-notes { font-size: 0.85rem; opacity: 0.7; line-height: 1.4; margin-bottom: 10px; }
        .book-notes-label { font-weight: 600; opacity: 0.8; }
        .recommend-badge { display: inline-block; background: linear-gradient(135deg, #667eea, #f093fb); color: #fff; padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; margin-top: 10px; }
        
        /* Edit Button */
        .edit-book-btn { position: absolute; top: 15px; right: 15px; width: 40px; height: 40px; border-radius: 50%; background: rgba(255, 255, 255, 0.95); border: 2px solid #e5e5e7; display: flex; align-items: center; justify-content: center; cursor: pointer; opacity: 0; transition: all 0.3s ease; font-size: 1.2rem; z-index: 10; box-shadow: 0 2px 8px rgba(0,0,0,0.15); }
        .book-card:hover .edit-book-btn { opacity: 1; }
        .edit-book-btn:hover { background: linear-gradient(135deg, #667eea, #764ba2); color: #fff; border-color: transparent; transform: scale(1.1); }
        .book-card { position: relative; }
        
        /* List View */
        .books-list { display: flex; flex-direction: column; gap: 20px; }
        .book-list-item { background: #fff; border-radius: 15px; padding: 20px 25px; border: 1px solid #e5e5e7; display: flex; align-items: center; gap: 15px; transition: all 0.3s ease; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .book-list-item:hover { background: linear-gradient(90deg, rgba(102, 126, 234, 0.05), rgba(240, 147, 251, 0.05)); transform: translateX(10px); box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-color: rgba(102, 126, 234, 0.3); }
        .list-number { font-size: 1rem; font-weight: 600; min-width: 35px; opacity: 0.3; color: #667eea; }
        .list-content { flex: 1; }
        .list-title { font-size: 1.3rem; font-weight: 600; margin-bottom: 5px; display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
        .list-author { font-size: 1rem; opacity: 0.6; }
        .list-meta { display: flex; align-items: center; gap: 15px; margin-top: 8px; }
        
        /* Library View */
        .library-view { position: relative; min-height: 80vh; display: flex; align-items: center; justify-content: center; perspective: 2000px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.03) 0%, rgba(118, 75, 162, 0.05) 50%, rgba(240, 147, 251, 0.03) 100%); border-radius: 30px; overflow: hidden; padding: 80px 120px; }
        .library-view::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%); animation: rotate 20s linear infinite; pointer-events: none; }
        .library-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border-radius: 40px; padding: 50px 60px; max-width: 1000px; width: 90%; border: 2px solid rgba(255, 255, 255, 0.8); box-shadow: 0 50px 100px rgba(102, 126, 234, 0.15), 0 20px 40px rgba(118, 75, 162, 0.1); text-align: center; position: relative; z-index: 1; display: flex; flex-direction: column; align-items: center; }
        .library-number { font-size: 1.2rem; opacity: 0.3; margin-bottom: 20px; font-weight: 300; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .library-title { font-size: 2.8rem; font-weight: 600; margin-bottom: 20px; line-height: 1.2; text-shadow: 0 2px 10px rgba(102, 126, 234, 0.1); }
        .library-author { font-size: 1.4rem; opacity: 0.6; margin-bottom: 30px; font-weight: 300; }
        .library-rating { font-size: 2rem; margin-bottom: 25px; filter: drop-shadow(0 2px 8px rgba(102, 126, 234, 0.2)); }
        .library-notes { font-size: 1.1rem; line-height: 1.7; opacity: 0.75; margin-bottom: 20px; font-style: italic; max-width: 700px; }
        .library-genre { font-size: 1rem; opacity: 0.5; margin-bottom: 20px; }
        .library-nav-container { position: absolute; top: 50%; left: 0; right: 0; transform: translateY(-50%); display: flex; justify-content: space-between; z-index: 10; padding: 0 20px; pointer-events: none; }
        .nav-btn { width: 60px; height: 60px; border-radius: 50%; border: 2px solid #e5e5e7; background: #fff; color: #1d1d1f; font-size: 1.5rem; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); pointer-events: all; }
        .nav-btn:hover { background: linear-gradient(135deg, #667eea, #764ba2); color: #fff; border-color: transparent; transform: scale(1.1); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4); }
        
        /* Admin Panel */
        .admin-panel { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(10px); display: none; align-items: center; justify-content: center; z-index: 1000; }
        .admin-panel.active { display: flex; }
        .admin-form { background: #fff; border: 2px solid #e5e5e7; border-radius: 20px; padding: 40px; max-width: 600px; width: 90%; max-height: 85vh; overflow-y: auto; box-shadow: 0 30px 60px rgba(0,0,0,0.3); }
        .admin-form h2 { color: #1d1d1f; margin-bottom: 10px; }
        .admin-hint { font-size: 0.9rem; opacity: 0.6; margin-bottom: 30px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: #1d1d1f; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px; border: 1px solid #e5e5e7; background: #f5f5f7; border-radius: 10px; color: #1d1d1f; font-size: 1rem; font-family: inherit; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: #667eea; background: #fff; }
        .form-group textarea { min-height: 100px; resize: vertical; }
        .form-actions { display: flex; gap: 15px; margin-top: 30px; }
        .btn { padding: 12px 30px; border: 1px solid #e5e5e7; background: #f5f5f7; color: #1d1d1f; border-radius: 50px; cursor: pointer; font-size: 1rem; font-weight: 500; transition: all 0.3s ease; flex: 1; }
        .btn:hover { background: #e5e5e7; transform: translateY(-2px); }
        .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color: #fff; border: none; }
        .btn-primary:hover { box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); }
        .btn-danger { background: linear-gradient(135deg, #f56565, #c53030); color: #fff; border: none; }
        .btn-danger:hover { box-shadow: 0 4px 15px rgba(245, 101, 101, 0.3); }
        
        .btn-fetch { background: linear-gradient(135deg, #4CAF50, #45a049); color: #fff; border: none; }
        .btn-fetch:hover { box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3); }
        .btn-fetch:disabled { opacity: 0.6; cursor: not-allowed; }
        
        .cover-preview { margin-top: 15px; text-align: center; }
        .cover-preview img { max-width: 200px; max-height: 300px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        
        .loading-spinner { display: inline-block; width: 16px; height: 16px; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: #fff; animation: spin 0.8s linear infinite; margin-left: 8px; }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Edit Panel */
        .edit-panel { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(10px); display: none; align-items: center; justify-content: center; z-index: 1001; }
        .edit-panel.active { display: flex; }
        
        /* Book Actions */
        .book-actions { display: flex; gap: 10px; margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e5e7; opacity: 0; transition: opacity 0.3s ease; }
        .book-card:hover .book-actions { opacity: 1; }
        .book-action-btn { padding: 8px 16px; border: 1px solid #e5e5e7; background: #fff; color: #1d1d1f; border-radius: 25px; cursor: pointer; font-size: 0.85rem; font-weight: 500; transition: all 0.3s ease; flex: 1; }
        .book-action-btn:hover { background: #f5f5f7; transform: translateY(-1px); }
        .book-action-btn.edit { background: linear-gradient(135deg, #667eea, #764ba2); color: #fff; border: none; }
        .book-action-btn.edit:hover { box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); }
        
        /* Fetch Cover Button */
        .fetch-cover-btn { display: inline-block; margin-left: 10px; padding: 8px 16px; background: linear-gradient(135deg, #667eea, #764ba2); color: #fff; border: none; border-radius: 25px; cursor: pointer; font-size: 0.9rem; font-weight: 500; transition: all 0.3s ease; }
        .fetch-cover-btn:hover { box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); transform: translateY(-1px); }
        .fetch-cover-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Literary Journey 2025</h1>
            <p class="subtitle">A curated collection of transformative reads</p>
        </header>
        <div class="stats-banner">
            <h2 id="statsCount">Loading your books...</h2>
            <p id="statsAverage">Just a moment...</p>
        </div>
        <div class="controls">
            <div class="view-toggle">
                <button class="view-btn active" data-view="grid">Grid</button>
                <button class="view-btn" data-view="list">List</button>
                <button class="view-btn" data-view="library">Library</button>
            </div>
            <button class="filter-toggle">Show Recommendations Only</button>
        </div>
        <div id="booksContainer"></div>
    </div>

    <div class="admin-panel" id="adminPanel">
        <div class="admin-form">
            <h2 id="adminTitle">Add New Book</h2>
            <p class="admin-hint">Press Ctrl+Shift+A to open ‚Ä¢ ESC to close</p>
            <form id="addBookForm">
                <input type="hidden" id="editingBookNumber" value="">
                <div class="form-group">
                    <label>Book Title *</label>
                    <input type="text" name="title" id="bookTitle" required>
                </div>
                <div class="form-group">
                    <label>Author *</label>
                    <input type="text" name="author" id="bookAuthor" required>
                </div>
                <div class="form-group">
                    <label>Book Cover URL</label>
                    <input type="url" name="cover" id="bookCover" placeholder="https://covers.openlibrary.org/...">
                    <button type="button" class="btn btn-fetch" id="fetchCoverBtn" onclick="fetchBookCover()" style="margin-top: 10px; width: 100%;">üîç Auto-Fetch Cover from Open Library</button>
                    
                    <div style="margin-top: 15px; padding: 15px; background: #f5f5f7; border-radius: 10px; font-size: 0.85rem; line-height: 1.6;">
                        <p style="font-weight: 600; margin-bottom: 8px;">üìå How to add cover images:</p>
                        <p style="margin-bottom: 5px;">1. Click "Auto-Fetch" button above to search Open Library</p>
                        <p style="margin-bottom: 5px;">2. Or paste an image URL from the web</p>
                        <p style="margin-bottom: 5px;">3. Google Images: Right-click image ‚Üí "Copy image address"</p>
                        <p style="margin-top: 10px; opacity: 0.7; font-size: 0.8rem;">üí° Tip: Try <a href="https://covers.openlibrary.org" target="_blank" style="color: #667eea;">covers.openlibrary.org</a> or <a href="https://www.google.com/imghp" target="_blank" style="color: #667eea;">Google Images</a></p>
                    </div>
                    
                    <div id="coverPreview" style="margin-top: 10px; display: none;"></div>
                </div>
                <div class="form-group">
                    <label>Rating</label>
                    <select name="rating" id="bookRating">
                        <option value="">No rating</option>
                        <option value="‚≠ê">‚≠ê</option>
                        <option value="‚≠ê‚≠ê">‚≠ê‚≠ê</option>
                        <option value="‚≠ê‚≠ê‚≠ê">‚≠ê‚≠ê‚≠ê</option>
                        <option value="‚≠ê‚≠ê‚≠ê‚≠ê">‚≠ê‚≠ê‚≠ê‚≠ê</option>
                        <option value="‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea name="notes" id="bookNotes" placeholder="Your thoughts about this book..."></textarea>
                </div>
                <div class="form-group">
                    <label>Genre</label>
                    <input type="text" name="genre" id="bookGenre" placeholder="e.g., Fiction, Business, Psychology">
                </div>
                <div class="form-group">
                    <label>Recommend?</label>
                    <select name="recommend" id="bookRecommend">
                        <option value="No">No</option>
                        <option value="Yes">Yes</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn" onclick="closeAdmin()">Cancel</button>
                    <button type="button" class="btn btn-danger" id="deleteBookBtn" onclick="deleteBook()" style="display: none;">Delete Book</button>
                    <button type="button" class="btn btn-primary" onclick="saveBook()" id="saveBookBtn">Add Book</button>
                </div>
            </form>
        </div>
    </div>

    <div class="edit-panel" id="editPanel">
        <div class="admin-form">
            <h2>Edit Book</h2>
            <p class="admin-hint">Update book details ‚Ä¢ ESC to close</p>
            <form id="editBookForm">
                <input type="hidden" id="editBookNumber">
                <div class="form-group">
                    <label>Book Title *</label>
                    <input type="text" id="editTitle" required>
                </div>
                <div class="form-group">
                    <label>Author *</label>
                    <input type="text" id="editAuthor" required>
                </div>
                <div class="form-group">
                    <label>Book Cover URL</label>
                    <input type="url" id="editCover" placeholder="https://covers.openlibrary.org/...">
                    <div id="coverPreview" class="cover-preview"></div>
                </div>
                <div class="form-group">
                    <button type="button" class="btn btn-fetch" id="fetchCoverBtn" onclick="fetchBookCover()">
                        üîç Auto-Fetch Cover
                    </button>
                </div>
                <div class="form-group">
                    <label>Rating</label>
                    <select id="editRating">
                        <option value="">No rating</option>
                        <option value="‚≠ê">‚≠ê</option>
                        <option value="‚≠ê‚≠ê">‚≠ê‚≠ê</option>
                        <option value="‚≠ê‚≠ê‚≠ê">‚≠ê‚≠ê‚≠ê</option>
                        <option value="‚≠ê‚≠ê‚≠ê‚≠ê">‚≠ê‚≠ê‚≠ê‚≠ê</option>
                        <option value="‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="editNotes" placeholder="Your thoughts about this book..."></textarea>
                </div>
                <div class="form-group">
                    <label>Genre</label>
                    <input type="text" id="editGenre" placeholder="e.g., Fiction, Business, Psychology">
                </div>
                <div class="form-group">
                    <label>Recommend?</label>
                    <select id="editRecommend">
                        <option value="No">No</option>
                        <option value="Yes">Yes</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn" onclick="closeEdit()">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="deleteBook()">Delete</button>
                    <button type="button" class="btn btn-primary" onclick="updateBook()">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let books = [];
        let showRecommendationsOnly = false;
        let currentView = 'grid';
        let currentLibraryIndex = 0;
        
        async function init() {
            try {
                // Try to load from window.storage first
                const stored = await window.storage.get('literary-bookshelf-2025');
                if (stored && stored.value) {
                    const rawBooks = JSON.parse(stored.value);
                    const seen = new Map();
                    const uniqueBooks = [];
                    rawBooks.forEach(book => {
                        const key = book.title.toLowerCase().trim().replace(/["""]/g, '') + '|' + book.author.toLowerCase().trim();
                        if (!seen.has(key)) {
                            seen.set(key, true);
                            uniqueBooks.push(book);
                        }
                    });
                    books = uniqueBooks.map((book, index) => ({ ...book, number: index + 1 }));
                    if (books.length !== rawBooks.length) {
                        await saveBooks();
                    }
                    console.log('Loaded', books.length, 'books from window.storage');
                } else {
                    // Try localStorage as fallback
                    const localStored = localStorage.getItem('literary-bookshelf-2025');
                    if (localStored) {
                        books = JSON.parse(localStored);
                        console.log('Loaded', books.length, 'books from localStorage');
                    } else {
                        // Initialize with sample books if no data exists
                        books = getSampleBooks();
                        await saveBooks();
                    }
                }
            } catch (e) {
                console.log('Storage error:', e);
                // Try localStorage as final fallback
                try {
                    const localStored = localStorage.getItem('literary-bookshelf-2025');
                    if (localStored) {
                        books = JSON.parse(localStored);
                        console.log('Loaded', books.length, 'books from localStorage (fallback)');
                    } else if (books.length === 0) {
                        books = getSampleBooks();
                    }
                } catch (localError) {
                    console.log('localStorage also failed:', localError);
                    if (books.length === 0) {
                        books = getSampleBooks();
                    }
                }
            }
            render();
            setupListeners();
        }
        
        async function saveBooks() {
            const booksData = JSON.stringify(books);
            
            // Try window.storage first
            try {
                await window.storage.set('literary-bookshelf-2025', booksData);
                console.log('Saved to window.storage');
                // Also save to localStorage as backup
                localStorage.setItem('literary-bookshelf-2025', booksData);
                return true;
            } catch (e) {
                console.error('window.storage failed:', e);
                // Fall back to localStorage only
                try {
                    localStorage.setItem('literary-bookshelf-2025', booksData);
                    console.log('Saved to localStorage (fallback)');
                    return true;
                } catch (localError) {
                    console.error('localStorage also failed:', localError);
                    throw new Error('Unable to save books. Storage is full or unavailable.');
                }
            }
        }
        
        function getSampleBooks() {
            return [
  {
    "number": 1,
    "title": "Shoe Dog",
    "author": "Phil Knight",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "Fascinating, turbulent origin story of Nike.",
    "genre": "Biography, Business, Leadership & Management",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 2,
    "title": "Say It Well",
    "author": "Terry Szuplat",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "Love getting the perspective of a presidential speech writer. 50 (think) -25 (write) -25 (practice) rule.",
    "genre": "Communication, Leadership & Management",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 3,
    "title": "Good Morning, Monster",
    "author": "Catherine Gildiner",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "I LOVE THESE STORIES. Transformative, inspiring, fascinating. Also gives me hope for people doing the work and healing.",
    "genre": "Medical & Health, Psychology",
    "recommend": "Yes",
    "cover": ""
  },
  {
    "number": 4,
    "title": "Rest is Resistence",
    "author": "Tricia Hersey",
    "rating": "",
    "notes": "",
    "genre": "Social Justice",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 5,
    "title": "Educated",
    "author": "Tara Westover",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "Cult girl's hard history growing up and her triumphs. Also, WTF is wrong with Shawn?!",
    "genre": "Biography",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 6,
    "title": "Get Organized the Clear and Simple Way",
    "author": "Marla Dee",
    "rating": "",
    "notes": "Handling paper: sort, read, toss, action; bankers box, etc.",
    "genre": "Organization, Productivity",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 7,
    "title": "You Just Need to Lose Weight",
    "author": "Audrey Gordon",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "Fat activism.",
    "genre": "Medical & Health, Social Justice",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 8,
    "title": "Outer Order, Inner Calm",
    "author": "Gretchen Rubin",
    "rating": "",
    "notes": "",
    "genre": "Organization, Productivity",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 9,
    "title": "You Are a Badass at Making Money",
    "author": "Jen Sincero",
    "rating": "",
    "notes": "I listened to it because I want to update my relationship with money.",
    "genre": "Business, Money",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 10,
    "title": "The Year of Less",
    "author": "Cait Flanders",
    "rating": "",
    "notes": "",
    "genre": "Organization, Productivity",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 11,
    "title": "Why Has Nobody Told Me This Before?",
    "author": "Dr. Julie Smith",
    "rating": "",
    "notes": "Concepts I've known fairly well.",
    "genre": "Medical & Health, Productivity, Psychology",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 12,
    "title": "The Rigor of Angels",
    "author": "William Egginton",
    "rating": "",
    "notes": "I'm out of my depth on this topic, but great to listen to how a poet, a physicist, and a philosopher explored the nature of reality.",
    "genre": "Physics",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 13,
    "title": "Chatter",
    "author": "Ethan Kross",
    "rating": "",
    "notes": "",
    "genre": "Medical & Health, Psychology",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 14,
    "title": "What My Bones Know",
    "author": "Stephanie Foo",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "Abandoned, abused, & traumatized cPTSD girl found love and herself, interviews with previous teachers, friends, and her therapist",
    "genre": "Biography, Love & Marriage, Medical & Health, Psychology",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 15,
    "title": "How to Keep House While Drowning",
    "author": "KC Davis",
    "rating": "",
    "notes": "Not a moral failure if you don't have a clean & organized home.",
    "genre": "Organization, Productivity",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 16,
    "title": "When the Body Says No",
    "author": "Gabor Mat√©",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "Stress leading to physical (chronic) diseases and notes on self-healing.",
    "genre": "Medical & Health, Psychology",
    "recommend": "Yes",
    "cover": ""
  },
  {
    "number": 17,
    "title": "The Myth of Normal",
    "author": "Daniel Mat√©, Gabor Mat√©",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "The Normal state and what we normalize as normal.",
    "genre": "Medical & Health, Psychology",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 18,
    "title": "How to Do the Work",
    "author": "Dr. Nicole LePera",
    "rating": "",
    "notes": "",
    "genre": "Medical & Health, Psychology",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 19,
    "title": "Travelers to Unimaginable Lands",
    "author": "Dasha Kiper",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "Beautiful focus on the caretaker of people with dementia and their experience with living with the long-gone person and the current body.",
    "genre": "Medical & Health",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 20,
    "title": "Break the Cycle",
    "author": "Dr. Mariel Buqu√©",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "Tree metaphor, intergenerational trauma and healing, sound bath & exercises.",
    "genre": "Medical & Health, Psychology",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 21,
    "title": "It's not Me, It's You",
    "author": "John Kim, Vanessa Bennett",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "Even therapists have their challenges - talk it out to build an expansive relationship.",
    "genre": "Communication, Love & Marriage",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 22,
    "title": "Creative Hustle",
    "author": "Olatunde Sobomehin, sam seidel",
    "rating": "",
    "notes": "Stanford D School Book Club ‚Äì case studies, and more worksheet type of exercises for you to explore how & where you want to take your creative hustle.",
    "genre": "Business, Design, Productivity",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 23,
    "title": "Rewire",
    "author": "Nicole Vignola",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "Good practices of mental growth.",
    "genre": "Productivity, Psychology",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 24,
    "title": "Pitch Perfect",
    "author": "Bill McGowan",
    "rating": "",
    "notes": "Initially lost me but the latter parts were fairly good on how to pitch or communicate and relate to the audience for bigger impacts.",
    "genre": "Business, Communication",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 25,
    "title": "The Hidden Life of Trees",
    "author": "Peter Wohlleben",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "Beautiful account of trees' life cycle, forest ecosystems, environments, relocated & urban plants.",
    "genre": "Environment",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 26,
    "title": "Nonviolent Communication",
    "author": "Marshall Rosenberg",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "1. Empathetic clarification, 2. Non-judgemental focus on needs.",
    "genre": "",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 27,
    "title": "Make Possibilities Happen",
    "author": "Grace Hawthorne",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "Stanford D School Book Club, good exercises, bad accessibility / readability.",
    "genre": "Business, Design, Productivity",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 28,
    "title": "Game of Edges",
    "author": "Bruce Schoenfeld",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "Interesting area of sports entertainment and obsessive data metrics that I didn't know about.",
    "genre": "Business, Data, Money",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 29,
    "title": "Leadership Strategy and Tactics",
    "author": "Jocko Willink",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "Brilliant! Humble. Transformed and elevated my thoughts on how I'd practice leadership. Prioritize and execute. Detach. No job is beneath you. Train juniors / train people out.",
    "genre": "Leadership & Management",
    "recommend": "Yes",
    "cover": ""
  },
  {
    "number": 30,
    "title": "Money and Love",
    "author": "Myra Strober, Abby Davisson",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "Super practical approaches in major life decisions, 5C methods, especially love the consider a wide range of alternatives.",
    "genre": "Love & Marriage, Money",
    "recommend": "Yes",
    "cover": ""
  },
  {
    "number": 31,
    "title": "Your Next Five Moves",
    "author": "Patrick Bet-David",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "Who do you want to be? What are your metrics? Needed this.",
    "genre": "Business, Leadership & Management, Productivity",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 32,
    "title": "Leadership BS",
    "author": "Jeffrey Pyffer",
    "rating": "",
    "notes": "!!?? Showing the reality of bad and manipulative leaderships among people trying to get ahead.",
    "genre": "Leadership & Management",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 33,
    "title": "The Experience Machine",
    "author": "Andy Clark",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "Pretty cool: our brains as predictive machines, various top-down perceptions like: your expectation shapes your reality, placebos & nocebos, phantom pain, etc.",
    "genre": "",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 34,
    "title": "The Fun Habit",
    "author": "Mike Rucker",
    "rating": "‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è",
    "notes": "Just all right. New idea: fun activities with kids that work for adults.",
    "genre": "",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 35,
    "title": "Black Box Thinking",
    "author": "Matthew Syed",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "Really enjoyed this! I had a moment equivalent to can't put it down in physical books with this audio book. Just like examining the Black Boxes in the aviation industry, some valuable lessons: not rushing to blames, consider the data that's not there, marginal gains.",
    "genre": "Data, Leadership & Management, Medical & Health",
    "recommend": "Yes",
    "cover": ""
  },
  {
    "number": 36,
    "title": "The Bird Way",
    "author": "Jennifer Ackerman",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "",
    "genre": "",
    "recommend": "Yes",
    "cover": ""
  },
  {
    "number": 37,
    "title": "The Birds that Audubon Missed",
    "author": "Kenn Kaufman",
    "rating": "",
    "notes": "",
    "genre": "",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 38,
    "title": "The Good Enough Job",
    "author": "Simone Stolzoff",
    "rating": "",
    "notes": "",
    "genre": "",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 39,
    "title": "Rest",
    "author": "Alex Soojung-Kim Pang",
    "rating": "",
    "notes": "",
    "genre": "",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 40,
    "title": "Inner Excellence",
    "author": "Jim Murphy",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "",
    "genre": "",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 41,
    "title": "The 5 Types of Wealth",
    "author": "Sahil Bloom",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "",
    "genre": "",
    "recommend": "Yes",
    "cover": ""
  },
  {
    "number": 42,
    "title": "How We Learn to Be Brave",
    "author": "Mariann Edgar Budde",
    "rating": "",
    "notes": "",
    "genre": "",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 43,
    "title": "All About Love",
    "author": "bell hooks",
    "rating": "",
    "notes": "",
    "genre": "",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 44,
    "title": "Mating in Captivity",
    "author": "Esther Perel",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "",
    "genre": "",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 45,
    "title": "When Angels Speak of Love",
    "author": "bell hooks",
    "rating": "",
    "notes": "",
    "genre": "",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 46,
    "title": "Our Time is Now",
    "author": "Stacey Abrams",
    "rating": "",
    "notes": "",
    "genre": "",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 47,
    "title": "Write for Life",
    "author": "Julia Cameron",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "Super motivational and approachable coaching on how to maintain a writing habit. Morning pages, 20 minutes, specific writing stations, etc.",
    "genre": "",
    "recommend": "Yes",
    "cover": ""
  },
  {
    "number": 48,
    "title": "Pronoun Trouble",
    "author": "John McWhorter",
    "rating": "",
    "notes": "",
    "genre": "",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 49,
    "title": "Everything is Tuberculosis",
    "author": "John Green",
    "rating": "",
    "notes": "Biggest takeaways are the lack of investment in healthcare treatments when it comes to the population in third world countries, and big pharma gatekeeping and making treatments extremely costly and inaccessible for those who really need it.",
    "genre": "",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 50,
    "title": "Life After Capitalism",
    "author": "George Gilder",
    "rating": "‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è",
    "notes": "",
    "genre": "",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 51,
    "title": "Making a Scene",
    "author": "Constance Wu",
    "rating": "",
    "notes": "",
    "genre": "",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 52,
    "title": "Discipline is Destiny",
    "author": "Ryan Holiday",
    "rating": "",
    "notes": "",
    "genre": "",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 53,
    "title": "Change the Recipe",
    "author": "Jos√© Andr√©s",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "Inspiring!! Jos√©'s food stories, human stories, his journey from Spain to the United States, and his venture to create the World Food Kitchen and feeding disaster-stricken and war-torn countries and regions. This book had me applauding at home at the end.",
    "genre": "",
    "recommend": "Yes",
    "cover": ""
  },
  {
    "number": 54,
    "title": "Careless People",
    "author": "Sarah Wynn-Williams",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "Facebook leadership expos√©",
    "genre": "",
    "recommend": "Yes",
    "cover": ""
  },
  {
    "number": 55,
    "title": "Frames of Mind",
    "author": "Howard Gardner",
    "rating": "",
    "notes": "multi-intelligence theory",
    "genre": "",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 56,
    "title": "Who is Government?",
    "author": "Michael Lewis",
    "rating": "",
    "notes": "Great essays on dedicated people doing public services in different branches of the government, shedding light on some of the invisible yet critical contributions by public servants.",
    "genre": "",
    "recommend": "No",
    "cover": ""
  },
  {
    "number": 57,
    "title": "abundance",
    "author": "Ezra Klein, Derek Thompson",
    "cover": "",
    "rating": "",
    "notes": "",
    "genre": "",
    "recommend": "No"
  },
  {
    "number": 58,
    "title": "The Artist's Way",
    "author": "Julia Cameron",
    "cover": "",
    "rating": "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
    "notes": "",
    "genre": "",
    "recommend": "Yes"
  }
];
        }
        
        function render() {
            const totalBooks = books.length;
            const avgPerMonth = (totalBooks / 10).toFixed(1);
            document.getElementById('statsCount').textContent = totalBooks + ' books completed this year! üéâ';
            document.getElementById('statsAverage').textContent = "That's " + avgPerMonth + " books a month on average";
            
            const container = document.getElementById('booksContainer');
            const filtered = showRecommendationsOnly ? books.filter(b => b.recommend === 'Yes') : books;
            
            if (filtered.length === 0) {
                container.innerHTML = '<div style="text-align:center;padding:40px;">No books found</div>';
                return;
            }
            
            if (currentView === 'grid') {
                renderGrid(container, filtered);
            } else if (currentView === 'list') {
                renderList(container, filtered);
            } else if (currentView === 'library') {
                renderLibrary(container, filtered);
            }
        }
        
        function renderGrid(container, filtered) {
            container.innerHTML = '<div class="books-grid">' + filtered.map(book => `
                <div class="book-card" onclick="openEditModal(${book.number})">
                    <div class="book-card-content" style="padding-top: 25px;">
                        ${!showRecommendationsOnly ? '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;"><div style="font-size: 0.85rem; opacity: 0.5; font-weight: 600; padding: 4px 0; margin-top: 10px;">#' + book.number + '</div>' + (book.recommend === 'Yes' ? '<span class="recommend-badge" style="font-size: 0.7rem; padding: 4px 10px; margin-top: 10px;">Recommended</span>' : '') + '</div>' : ''}
                        <div class="book-title">${book.title}</div>
                        <div class="book-author">${book.author}</div>
                        ${book.rating ? '<div class="book-rating">' + book.rating + '</div>' : ''}
                        ${book.genre ? '<div class="book-genre">' + book.genre + '</div>' : ''}
                        ${book.notes ? '<div class="book-notes"><span class="book-notes-label">Notes:</span> ' + book.notes + '</div>' : ''}
                        <div class="book-actions">
                            <button class="book-action-btn edit" onclick="event.stopPropagation(); openEditModal(${book.number});">‚úèÔ∏è Edit Book</button>
                        </div>
                    </div>
                </div>
            `).join('') + '</div>';
        }
        
        function renderList(container, filtered) {
            container.innerHTML = '<div class="books-list">' + filtered.map(book => `
                <div class="book-list-item" onclick="openEditModal(${book.number})">
                    ${!showRecommendationsOnly ? '<div class="list-number">#' + book.number + '</div>' : ''}
                    <div class="list-content">
                        <div class="list-title">
                            ${book.title}
                            ${book.recommend === 'Yes' && !showRecommendationsOnly ? '<span class="recommend-badge" style="font-size: 0.65rem; padding: 4px 10px; margin-left: 8px;">Recommended</span>' : ''}
                        </div>
                        <div class="list-author">by ${book.author}</div>
                        <div class="list-meta">
                            ${book.rating ? '<span>' + book.rating + '</span>' : ''}
                            ${book.genre ? '<span style="opacity: 0.5; font-size: 0.9rem;">' + book.genre + '</span>' : ''}
                        </div>
                    </div>
                </div>
            `).join('') + '</div>';
        }
        
        function renderLibrary(container, filtered) {
            if (currentLibraryIndex >= filtered.length) currentLibraryIndex = 0;
            const book = filtered[currentLibraryIndex];
            container.innerHTML = `
                <div class="library-view">
                    <div class="library-nav-container">
                        <button class="nav-btn" onclick="previousBook()">‚Üê</button>
                        <button class="nav-btn" onclick="nextBook()">‚Üí</button>
                    </div>
                    <div class="library-card">
                        ${!showRecommendationsOnly ? '<div class="library-number">Book #' + book.number + '</div>' : ''}
                        <div class="library-title">${book.title}</div>
                        <div class="library-author">by ${book.author}</div>
                        ${book.rating ? '<div class="library-rating">' + book.rating + '</div>' : ''}
                        ${book.notes ? '<div class="library-notes">' + book.notes + '</div>' : ''}
                        ${book.genre ? '<div class="library-genre">' + book.genre + '</div>' : ''}
                        ${book.recommend === 'Yes' && !showRecommendationsOnly ? '<span class="recommend-badge">‚ú® Recommended</span>' : ''}
                    </div>
                </div>
            `;
        }
        
        function nextBook() {
            const filtered = showRecommendationsOnly ? books.filter(b => b.recommend === 'Yes') : books;
            currentLibraryIndex = (currentLibraryIndex + 1) % filtered.length;
            render();
        }
        
        function previousBook() {
            const filtered = showRecommendationsOnly ? books.filter(b => b.recommend === 'Yes') : books;
            currentLibraryIndex = (currentLibraryIndex - 1 + filtered.length) % filtered.length;
            render();
        }
        
        function setupListeners() {
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentView = btn.dataset.view;
                    currentLibraryIndex = 0;
                    render();
                });
            });
            
            document.querySelector('.filter-toggle').addEventListener('click', (e) => {
                showRecommendationsOnly = !showRecommendationsOnly;
                e.target.classList.toggle('active');
                currentLibraryIndex = 0;
                render();
            });
            
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                    e.preventDefault();
                    document.getElementById('adminPanel').classList.add('active');
                }
                if (e.key === 'Escape') {
                    closeAdmin();
                }
            });
            
            // Setup cover preview
            setupCoverPreview();
        }
        
        function openEditModal(bookNumber) {
            const book = books.find(b => b.number === bookNumber);
            if (!book) return;
            
            // Populate the form with book data
            document.getElementById('adminTitle').textContent = 'Edit Book';
            document.getElementById('editingBookNumber').value = bookNumber;
            document.getElementById('bookTitle').value = book.title;
            document.getElementById('bookAuthor').value = book.author;
            document.getElementById('bookCover').value = book.cover || '';
            document.getElementById('bookRating').value = book.rating || '';
            document.getElementById('bookNotes').value = book.notes || '';
            document.getElementById('bookGenre').value = book.genre || '';
            document.getElementById('bookRecommend').value = book.recommend || 'No';
            
            // Show delete button, change save button text
            document.getElementById('deleteBookBtn').style.display = 'block';
            document.getElementById('saveBookBtn').textContent = 'Update Book';
            
            // Show the modal
            document.getElementById('adminPanel').classList.add('active');
        }
        
        function saveBook() {
            const form = document.getElementById('addBookForm');
            const formData = new FormData(form);
            const editingNumber = document.getElementById('editingBookNumber').value;
            
            const title = formData.get('title');
            const author = formData.get('author');
            
            if (!title || !author) {
                const statsCount = document.getElementById('statsCount');
                statsCount.textContent = '‚ùå Title and Author are required!';
                setTimeout(() => render(), 3000);
                return;
            }
            
            if (editingNumber) {
                // Edit existing book
                const bookIndex = books.findIndex(b => b.number === parseInt(editingNumber));
                if (bookIndex !== -1) {
                    books[bookIndex] = {
                        ...books[bookIndex],
                        title: title,
                        author: author,
                        cover: formData.get('cover') || '',
                        rating: formData.get('rating') || '',
                        notes: formData.get('notes') || '',
                        genre: formData.get('genre') || '',
                        recommend: formData.get('recommend') || 'No'
                    };
                    
                    saveBooks().then(() => {
                        render();
                        closeAdmin();
                        
                        const statsCount = document.getElementById('statsCount');
                        statsCount.textContent = '‚úÖ "' + title + '" updated successfully!';
                        setTimeout(() => render(), 3000);
                    }).catch(err => {
                        console.error('Save error:', err);
                        alert('Error saving book. Your changes could not be saved. Storage may be full.');
                    });
                }
            } else {
                // Add new book
                const newBook = {
                    number: books.length + 1,
                    title: title,
                    author: author,
                    cover: formData.get('cover') || '',
                    rating: formData.get('rating') || '',
                    notes: formData.get('notes') || '',
                    genre: formData.get('genre') || '',
                    recommend: formData.get('recommend') || 'No'
                };
                
                books.push(newBook);
                
                saveBooks().then(() => {
                    render();
                    closeAdmin();
                    
                    const statsCount = document.getElementById('statsCount');
                    statsCount.textContent = '‚ú® "' + newBook.title + '" added successfully!';
                    setTimeout(() => render(), 3000);
                }).catch(err => {
                    console.error('Save error:', err);
                    // Remove the book we just added since save failed
                    books.pop();
                    alert('Error saving book. Your changes could not be saved. Storage may be full.');
                });
            }
        }
        
        function deleteBook() {
            const editingNumber = document.getElementById('editingBookNumber').value;
            if (!editingNumber) return;
            
            const book = books.find(b => b.number === parseInt(editingNumber));
            if (!book) return;
            
            if (!confirm(`Are you sure you want to delete "${book.title}"?`)) {
                return;
            }
            
            books = books.filter(b => b.number !== parseInt(editingNumber));
            
            // Renumber the remaining books
            books = books.map((book, index) => ({ ...book, number: index + 1 }));
            
            saveBooks().then(() => {
                render();
                closeAdmin();
                
                const statsCount = document.getElementById('statsCount');
                statsCount.textContent = 'üóëÔ∏è Book deleted';
                setTimeout(() => render(), 3000);
            }).catch(err => {
                console.error('Delete error:', err);
                alert('Error deleting book. Changes could not be saved.');
            });
        }
        
        async function fetchBookCover() {
            const title = document.getElementById('bookTitle').value.trim();
            const author = document.getElementById('bookAuthor').value.trim();
            
            if (!title || !author) {
                alert('Please enter both title and author first');
                return;
            }
            
            const btn = document.getElementById('fetchCoverBtn');
            btn.disabled = true;
            btn.textContent = 'üîÑ Searching...';
            
            try {
                // Search Open Library API
                const searchQuery = encodeURIComponent(`${title} ${author}`);
                const searchUrl = `https://openlibrary.org/search.json?q=${searchQuery}&limit=5`;
                
                const response = await fetch(searchUrl, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.docs && data.docs.length > 0) {
                    // Try to find the best match with a cover
                    let coverFound = false;
                    
                    for (const doc of data.docs) {
                        if (doc.cover_i) {
                            const coverUrl = `https://covers.openlibrary.org/b/id/${doc.cover_i}-L.jpg`;
                            document.getElementById('bookCover').value = coverUrl;
                            showCoverPreview(coverUrl);
                            
                            coverFound = true;
                            btn.textContent = '‚úÖ Cover Found!';
                            setTimeout(() => {
                                btn.textContent = 'üîç Auto-Fetch Cover from Open Library';
                                btn.disabled = false;
                            }, 2000);
                            break;
                        }
                    }
                    
                    if (!coverFound) {
                        btn.textContent = '‚ùå No Cover Found';
                        alert(`No cover image found in Open Library.\n\nüìå Manual options:\n1. Google "${title}" cover image\n2. Right-click image ‚Üí "Copy image address"\n3. Paste URL in the field above`);
                        setTimeout(() => {
                            btn.textContent = 'üîç Auto-Fetch Cover from Open Library';
                            btn.disabled = false;
                        }, 2000);
                    }
                } else {
                    btn.textContent = '‚ùå Not Found';
                    alert(`Book not found in Open Library.\n\nüìå Manual options:\n1. Google "${title}" cover image\n2. Right-click image ‚Üí "Copy image address"\n3. Paste URL in the field above`);
                    setTimeout(() => {
                        btn.textContent = 'üîç Auto-Fetch Cover from Open Library';
                        btn.disabled = false;
                    }, 2000);
                }
            } catch (error) {
                console.error('Error fetching cover:', error);
                btn.textContent = '‚ùå Network Error';
                
                if (error.message.includes('Failed to fetch')) {
                    alert(`Unable to reach Open Library (network blocked).\n\nüìå Add cover manually:\n1. Open Google Images in new tab\n2. Search for "${title}" cover\n3. Right-click image ‚Üí "Copy image address"\n4. Paste URL in the field above\n\nExample URLs that work:\n‚Ä¢ covers.openlibrary.org/b/id/...\n‚Ä¢ m.media-amazon.com/images/...\n‚Ä¢ Any direct image URL`);
                } else {
                    alert(`Error: ${error.message}\n\nPlease add cover URL manually using Google Images.`);
                }
                
                setTimeout(() => {
                    btn.textContent = 'üîç Auto-Fetch Cover from Open Library';
                    btn.disabled = false;
                }, 3000);
            }
        }
        
        function addBook() {
            console.log('Add book called!');
            const form = document.getElementById('addBookForm');
            const formData = new FormData(form);
            
            const title = formData.get('title');
            const author = formData.get('author');
            
            if (!title || !author) {
                const statsCount = document.getElementById('statsCount');
                statsCount.textContent = '‚ùå Title and Author are required!';
                setTimeout(() => render(), 3000);
                return;
            }
            
            const newBook = {
                number: books.length + 1,
                title: title,
                author: author,
                cover: formData.get('cover') || '',
                rating: formData.get('rating') || '',
                notes: formData.get('notes') || '',
                genre: formData.get('genre') || '',
                recommend: formData.get('recommend') || 'No'
            };
            
            console.log('Adding book:', newBook);
            
            books.push(newBook);
            
            window.storage.set('literary-bookshelf-2025', JSON.stringify(books)).then(() => {
                console.log('Book saved!');
                render();
                closeAdmin();
                form.reset();
                
                const statsCount = document.getElementById('statsCount');
                statsCount.textContent = '‚ú® "' + newBook.title + '" added successfully!';
                setTimeout(() => {
                    const totalBooks = books.length;
                    const avgPerMonth = (totalBooks / 10).toFixed(1);
                    statsCount.textContent = totalBooks + ' books completed this year! üéâ';
                }, 3000);
            }).catch(err => {
                console.error('Save error:', err);
            });
        }
        
        async function fetchBookCover() {
            const title = document.getElementById('bookTitle').value.trim();
            const author = document.getElementById('bookAuthor').value.trim();
            
            if (!title || !author) {
                alert('Please enter both title and author first');
                return;
            }
            
            const btn = document.getElementById('fetchCoverBtn');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = 'üîÑ Searching...<span class="loading-spinner"></span>';
            
            try {
                // Search Open Library API
                const searchQuery = encodeURIComponent(`${title} ${author}`);
                const searchUrl = `https://openlibrary.org/search.json?q=${searchQuery}&limit=5`;
                
                const response = await fetch(searchUrl);
                const data = await response.json();
                
                if (data.docs && data.docs.length > 0) {
                    // Find the best match with a cover
                    let coverUrl = '';
                    for (const doc of data.docs) {
                        if (doc.cover_i) {
                            coverUrl = `https://covers.openlibrary.org/b/id/${doc.cover_i}-L.jpg`;
                            break;
                        }
                    }
                    
                    if (coverUrl) {
                        document.getElementById('bookCover').value = coverUrl;
                        showCoverPreview(coverUrl);
                        
                        const statsCount = document.getElementById('statsCount');
                        statsCount.textContent = '‚úÖ Cover found!';
                        setTimeout(() => render(), 2000);
                    } else {
                        alert('No cover image found for this book. Try entering the cover URL manually.');
                    }
                } else {
                    alert('Book not found. Try entering the cover URL manually or check the title/author spelling.');
                }
            } catch (error) {
                console.error('Error fetching cover:', error);
                alert('Error fetching cover. Please try again or enter the URL manually.');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }
        
        function showCoverPreview(url) {
            const preview = document.getElementById('coverPreview');
            if (url) {
                preview.innerHTML = `<img src="${url}" alt="Book cover preview" onerror="this.parentElement.innerHTML='<p style=color:#999>Cover not available</p>'">`;
                preview.style.display = 'block';
            } else {
                preview.innerHTML = '';
                preview.style.display = 'none';
            }
        }
        
        // Add event listener for cover URL input to show preview
        function setupCoverPreview() {
            const coverInput = document.getElementById('bookCover');
            if (coverInput) {
                coverInput.addEventListener('input', (e) => {
                    showCoverPreview(e.target.value);
                });
            }
        }
        
        function closeAdmin() {
            document.getElementById('adminPanel').classList.remove('active');
            
            // Reset form for adding new books
            document.getElementById('adminTitle').textContent = 'Add New Book';
            document.getElementById('editingBookNumber').value = '';
            document.getElementById('addBookForm').reset();
            document.getElementById('deleteBookBtn').style.display = 'none';
            document.getElementById('saveBookBtn').textContent = 'Add Book';
            document.getElementById('coverPreview').style.display = 'none';
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
